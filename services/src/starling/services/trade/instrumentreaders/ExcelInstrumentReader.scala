package starling.services.trade.instrumentreaders

import starling.models._
import starling.instrument._
import starling.daterange._
import starling.quantity.{UOMParse, Quantity}
import starling.services.trade.ExcelRow
import starling.market._
import starling.utils.ImplicitConversions._
import formula.InvalidFormulaIndexException


trait ExcelInstrumentReader {
  /**
   * Override this method and return true if the reader can handle this row
   */
  def canRead(row: ExcelRow): Boolean

  /**
   * Given the row create the instrument. This is only called if canHandle returned true.
   */
  def create(row: ExcelRow): Tradeable
}

case class ExcelInstrumentReaderException(s: String) extends Exception(s)

object ExcelInstrumentReader {
  import starling.market.Market._

  /**
   * aliases between what the traders put in the blotter and what we call the instruments
   */
  val instrumentAliases = Map("swap" -> CommoditySwap, "cso" -> CalendarSpreadOption, "option" -> FuturesOption,
    "asian" -> AsianOption, "apo" -> AsianOption)

  /**
   * aliases between what the traders put in the blotter and what we call the markets
   */
  val marketAliases: Map[String, CommodityMarket] = {
    import Market._

    def alias(aliases: (CommodityMarket, String)*): Map[String, CommodityMarket] = {
      aliases.toList.filter { case (market, alias) => market.name == alias }.map(_._2).update {
        redundantAliases => require(redundantAliases.isEmpty, "These market aliases are redundant: " + redundantAliases)
      }

      def conflicts(market: CommodityMarket, alias: String) = {
        Market.markets.find(_.name == alias).map(f => f != market).getOrElse(false)
      }

      aliases.toList.filter { case (market, alias) => conflicts(market, alias) }.map(_._2).update {
        conflictingAliases => require(conflictingAliases.isEmpty, "These market aliases conflict: " + conflictingAliases)
      }

      aliases.map { case (market, alias) => (alias.toLowerCase, market) }.toMap ++ Market.markets.toMapWithKeys(_.name.toLowerCase)
    }

    alias(
      BALTIC_CAPESIZE                         → "Capesize T/C Average (Baltic)",
      BALTIC_CAPESIZE_C7                      → "Capesize C7 Bolivar to Rotterdam (Baltic)",
      BALTIC_PANAMAX                          → "Panamax T/C Average diff (Baltic)",
      BALTIC_SUPRAMAX                         → "Baltic Supramax T/C Avg",
      GAS_OIL_ULSD_10PPM_CIF_NWE_CARGOES      → "Gas Oil ULSD 10ppm CIF NWE Cargoes (Platts)",
      GAS_OIL_ULSD_10PPM_FOB_ROTTERDAM_BARGES → "Gas Oil ULSD 10ppm FOB Rotterdam Barges (Platts)",
      ICE_BRENT                               → "ICE Brent 1st month Asia 1 minute marker",
      ICE_BRENT                               → "IPE Brent",
      ICE_BRENT                               → "IPE Brent 1st month",
      ICE_BRENT                               → "brent",
      ICE_GAS_OIL                             → "IPE Gas Oil",
      ICE_GAS_OIL                             → "NYMEX Gas Oil 1st month",
      NYMEX_GASOLINE                          → "NYMEX RBOB",
      NYMEX_GASOLINE                          → "nymex rbob",
      NYMEX_HEATING                           → "NYMEX Heat 1st month",
      NYMEX_NAT_GAS                           → "NYMEX Henry Hub Natural Gas",
      NYMEX_WTI                               → "NYMEX WTI 1st month",
      NYMEX_WTI                               → "wti",
      STEEL_REBAR_SHANGHAI                    → "SHFE Steel Rebar"
    )
  }

  def marketOption(marketName: String) = marketAliases.get(marketName.toLowerCase)

  /**
   * aliases between what the traders put in the blotter and what we call the indexes
   */
  val indexAliases: Map[String, Index] = {
    val indexToID = Map("Gas Oil ULSD 10ppm CIF NWE Cargoes (Platts) vs IPE Gas Oil" -> 849, "Minas ICP Formula" -> 1035, "NYMEX WTI vs Dated Brent" -> 39, "Unl 93 9RVP USGC Pipeline (Platts) vs NYMEX RBOB" -> 948, "Unl 87 0.3% Max MTBE 13.5 RVP NYH Barges (Platts) vs Nymex RBOB 1st month" -> 1168, "No.6 1% NYH Cargoes (Platts) vs No.6 2.2% NYH Cargoes (Platts)" -> 871, "Prem Unl Euro-Bob Oxy NWE Barges (Argus) vs IPE Brent" -> 1314, "Minas Vietnamese formula vs Platts Dubai 1st month" -> 1484, "Dated Brent vs Platts Brent (April)" -> 741, "Gas Oil 0.2% CIF NWE Cargoes (Platts) vs IPE Gas Oil [Settlement]" -> 433, "Unl 87 USGC Pipeline vs Unl 87 9 RVP USGC Waterborne (Platts)" -> 1010, "IPE Gas Oil [Settlement] vs Gas Oil 0.2% CIF Med Cargoes (Platts)" -> 396, "Prem Unl FOB Med Cargoes (Platts) vs Unl 95 FOB NWE Barges (Argus)" -> 423, "Dated Brent vs Platts Brent (December)" -> 749, "Panamax T/C Average diff (Baltic)" -> 511, "Unl 87 0.3% Max MTBE NYH Barges (Platts) vs NYMEX RBOB" -> 946, "IPE Gas Oil [Average] (Platts) vs Gas Oil 0.2% CIF Med Cargoes (Platts)" -> 395, "3.5% Fuel FOB Rotterdam Barges vs 3.5% Fuel FOB Med Cargoes" -> 192, "No.6 0.3% H/P NYH Cargoes vs No.6 1% NYH Cargoes" -> 161, "Belanak Crude (ICP)" -> 1407, "Widuri ICP Formula" -> 1038, "Minas (Platts) vs IPE Asian Brent 1 minute marker" -> 938, "IPE Gas Oil Average (Platts) vs Gas Oil ULSD 50ppm FOB Rotterdam Barges (Platts)" -> 55, "Gas Oil 0.5 Singapore vs Dubai 1st month" -> 166, "Jet FOB Rotterdam Barges (Platts) vs Jet CIF NWE Cargoes (Platts)" -> 966, "ICE Brent 1st month Asia 1 minute marker" -> 1281, "NYMEX WTI vs No.6 1% NYH Cargoes" -> 13, "Reg Unl USGC Waterborne (Platts) vs NYMEX Unleaded" -> 412, "Prem Unl 10ppm FOB Med Cargoes (Platts) vs Prem Unl Euro-Bob Oxy NWE Barges (Argus)" -> 1320, "Gas Oil ULSD 10ppm CIF Med (Platts) vs ICE Gas Oil 1st month" -> 1275, "Minas ICP formula (prior Oct 06)" -> 862, "No.2 CARB LA Pipeline (OPIS) vs NYMEX Heat" -> 593, "Minas ICP Formula vs IPE Asian Brent 1 Minute maker" -> 1493, "Gas Oil ULSD 50ppm Euro spec CIF NWE Cargoes (Platts) vs IPE Gas Oil" -> 850, "Prem Unl 10ppm FOB Rotterdam Barges (Platts) vs Eurobob FOB ARA Barges (Platts)" -> 1490, "Gas Oil EN590 CIF NWE Cargoes vs IPE Gas Oil (Average)" -> 49, "Mudi Crude (ICP)" -> 1406, "Oman Crude OSP vs Platts Dubai 1st month" -> 41, "Jet 54 USGC Pipeline (Platts) vs NYMEX Heat" -> 1031, "Madura Crude (ICP)" -> 1322, "Basra Asia OSP" -> 1017, "Minas ICP vs Dated Brent" -> 1045, "Unl 87 USGC Pipeline vs NYMEX WTI" -> 73, "Dated Brent vs Platts Brent 1st Month" -> 1216, "Ardjuna Crude (ICP)" -> 1285, "Gas Oil ULSD 10ppm FOB Rotterdam Barges (Platts) vs IPE Gas Oil" -> 882, "HSFO 180 CST Singapore Cargoes (Platts) vs No.6 3% USGC Waterborne (Platts)" -> 603, "Oman Crude vs Dubai 1st Month" -> 965, "Jet AG Cargoes (Platts) vs Jet Singapore Cargoes (Platts)" -> 910, "No.6 1% NYH Cargoes vs No.6 0.3% H/P NYH Cargoes (High)" -> 193, "1% Fuel CIF Med Cargoes (Platts) vs 1% Fuel FOB NWE Cargoes (Platts)" -> 559, "Reg Unl RBOB 83.7 USGC Pipeline (Platts) vs NYMEX RBOB 2nd month" -> 1078, "NYMEX Heat vs Jet LA Pipeline (Platts)" -> 407, "Unl 93 USGC Waterborne (Platts) vs NYMEX RBOB" -> 1009, "Biodiesel Rapeseed OME FOB Rotterdam Barges (Argus) vs IPE Gasoil" -> 1316, "Gas Oil EN590 CIF Med Cargoes (Platts) vs IPE Gas Oil [Settlement]" -> 394, "Dated Brent vs Platts Brent (July)" -> 744, "Prem Unl FOB Rotterdam Barges" -> 17, "Duri ICP Formula" -> 1033, "ICE WTI 1st month" -> 1091, "Prem Unl FOB Rotterdam Barges vs Jet CIF NWE Cargoes" -> 23, "Mogas 95 Unl 10ppm NWE Barges (Argus) vs Naphtha CIF NWE Cargoes" -> 115, "Gas Oil 0.1% FOB Rotterdam Barges (Platts) vs IPE Gas Oil [Settlement]" -> 1012, "Cinta ICP formula (prior Oct 06)" -> 865, "Mogas 92 Unl Singapore vs Prem Unl Euro-Bob Oxy NWE Barges Rotterdam (Argus)" -> 1478, "1% Fuel CIF Med Cargoes (Platts) vs 1% Fuel FOB NWE Barges (Platts)" -> 560, "No.6 3% USGC Waterborne (Platts) vs ICE WTI 1st month" -> 1564, "Reg Unl RBOB 83.7 USGC Pipeline (Platts) vs NYMEX RBOB" -> 1060, "Unl CARBOB LA Pipeline (OPIS) vs NYMEX RBOB" -> 947, "Bach Ho OSP" -> 569, "Biodiesel Rapeseed OME FOB Rotterdam Barges (Argus) vs ICE Gas Oil 1st month (Platts)" -> 1331, "No.6 3% USGC Waterborne" -> 11, "NYMEX WTI 1st month" -> 7, "Dated Brent vs Platts Brent (May)" -> 742, "Tapis (APPI) + Tapis OSP Premium" -> 1279, "1% Fuel FOB Rotterdam Barges (Platts) vs IPE Brent" -> 543, "Platts Brent 2nd Month" -> 1215, "Unl 87 USGC Pipeline (Platts) vs Reg Unl Supplemental USGC Pipeline (Platts)" -> 1014, "Fuel 0.5% FOB NYH PREPA formula" -> 1404, "No.2 LS USGC Pipeline (Platts) vs NYMEX Heat" -> 537, "Tapis (Platts/APPI)" -> 1438, "1% Fuel FOB Med Cargoes (Platts) vs 1% Fuel FOB NWE Cargoes (Platts)" -> 1313, "IPE Gas Oil 1st month (Settlement)" -> 58, "Natural Gasoline Non-Dynergy Pipeline (Platts) vs 91% NYMEX WTI 1st month (Platts)" -> 400, "Reg Unl RFG USGC Waterborne (Platts) vs NYMEX Unleaded" -> 415, "Unl 87 Rfg NYH Barges vs NYMEX Unleaded" -> 32, "Unl 87 USGC Pipeline vs NYMEX Unleaded" -> 94, "Gas Oil ULSD USGC Waterbourne (Platts) vs Nymex Heat 1st month" -> 1155, "Gas Oil 0.2% FOB NWE Cargoes (Platts) vs ICE Gas Oil 1st month (Settlement)" -> 1113, "Unl 95 FOB Singapore Cargoes (Platts) vs Unl 92 FOB Singapore Cargoes (Platts)" -> 1436, "Dated Brent vs Platts Brent (November)" -> 748, "Minas ICP vs IPE Brent 1st month" -> 1271, "NYMEX Heat vs IPE Gas Oil [Average] (Platts)" -> 405, "Unl 93 9RVP USGC Waterborne (Platts) vs NYMEX RBOB 1st month" -> 1111, "1% Fuel FOB NWE Cargoes (Platts) vs 3.5% Fuel FOB Med Cargoes (Platts)" -> 564, "FAME-0 FOB Rotterdam Barges (Argus) vs IPE Gasoil" -> 1317, "No.2 NYH Barges (Platts) vs NYMEX Heat" -> 1056, "HSFO 380 CST Singapore vs 3.5% Fuel FOB Rotterdam Barges" -> 1455, "Duri ICP formula (prior Oct 06)" -> 863, "LSWR Formula" -> 1327, "Unl 87 USGC Pipeline vs No.2 USGC Pipeline" -> 36, "HSFO 180 CST Singapore vs HSFO 380 CST Singapore" -> 133, "Jet LA Pipeline vs NYMEX Heat" -> 56, "Jet CIF NWE Cargoes vs IPE Gas Oil (Settlement)" -> 85, "Minas Vietnamese formula vs IPE Brent 1st month" -> 1483, "Widuri ICP Formula (prior Oct 07)" -> 993, "Reg Unl CARBOB LA Pipeline (OPIS) vs NYMEX Unleaded" -> 499, "No.6 0.7% NYH Cargoes (Platts) vs No.6 1% NYH Cargoes (Platts)" -> 587, "Prem Unl 50ppm FOB Med Cargoes (Platts) vs IPE Brent" -> 1118, "1% Fuel CIF NWE Cargoes (Platts) vs 1% Fuel FOB NWE Cargoes (Platts)" -> 586, "Minas Vietnamese Formula" -> 566, "Unl 87 NY/Boston Barges vs NYMEX Unleaded" -> 62, "Dated Brent vs Platts Brent 3rd Month" -> 1337, "Dated Brent vs Platts Brent (February)" -> 739, "Gas Oil 0.2% FOB Rotterdam Barges vs IPE Gas Oil [Settlement]" -> 556, "Prem Unl 10 ppm FOB Rotterdam Barges(Platts) vs Reg Unl FOB Rotterdam Barges(Platts)" -> 1013, "Reg Unl CARB 2% LA Pipeline (OPIS) vs NYMEX Unleaded" -> 414, "Bonny Light Diff Plus Dated Brent" -> 763, "NYMEX RBOB vs Prem Unl Euro-Bob Oxy NWE Barges (Argus)" -> 1315, "HSFO 380 CST Singapore" -> 134, "Tapis (Platts/APPI) vs Dubai 1st Month (Platts)" -> 1241, "Unl 92 Singapore Cargoes" -> 198, "1% Fuel CIF Med Cargoes (Platts) vs 1% Fuel CIF NWE Cargoes (Platts)" -> 558, "Platts Brent 1st Month" -> 317, "Cinta ICP Formula" -> 1036, "Platts Dubai 1st month" -> 6, "NYMEX Heat vs NYMEX WTI" -> 91, "Gas Oil ULSD USGC Pipeline (Platts) vs NYMEX Heat" -> 1040, "3.5% Fuel FOB Rotterdam Barges vs IPE Brent" -> 27, "ICE WTI 1st month vs ICE Brent 1st month" -> 1513, "Dated Brent vs Platts Brent 2nd Month" -> 1217, "NYMEX Gas Oil 1st month" -> 1431, "Dated Brent vs Platts Brent (January)" -> 738, "Jet LA Pipeline (OPIS) vs NYMEX Heat" -> 1018, "Minas ICP vs IPE Brent" -> 1046, "Unl 87 USGC Pipeline (Platts) vs NYMEX RBOB 2nd month" -> 1079, "NYMEX RBOB 1st month" -> 933, "Gasoil 0.5% FOB Arab Gulf (Platts) vs Gasoil 0.5% Singapore (Platts)" -> 1146, "Jet CIF NWE Cargoes vs Gas Oil EN590 CIF NWE Cargoes" -> 67, "NYMEX Unleaded vs NYMEX WTI" -> 97, "Naphtha Singapore vs Platts Dubai 1st month" -> 126, "NYMEX RBOB vs Unl 95 10ppm FOB Rotterdam Barges (Argus)" -> 957, "Dated Brent vs Platts Brent (October)" -> 747, "Gas Oil 0.1% FOB Med Cargoes (Platts) vs ICE Gas Oil 1st month" -> 1284, "1.5% Fuel FOB Rotterdam Barges (Platts) vs 3.5% Fuel FOB Rotterdam Barges (Platts)" -> 1097, "No.6 3% USGC Waterborne vs NYMEX WTI" -> 125, "Prem Unl 50ppm FOB Med Cargoes (Platts) vs Prem Unl 10ppm FOB R'dam Barges (Platts)" -> 1175, "LLS 1st month 14:15 Houston implied marker (Argus)" -> 990, "Unl 93 USGC Pipeline (Platts) vs NYMEX RBOB" -> 949, "Unl 87 USGC Pipeline" -> 34, "Prem Unl 10ppm FOB Rotterdam Barges (Platts) vs Prem Unl Euro-Bob Oxy NWE Barges (Argus)" -> 1415, "NYMEX WTI vs IPE Brent" -> 86, "Unl 93 USGC Pipeline (Platts) vs NYMEX RBOB 2nd Month" -> 1029, "NW Shelf (APPI) vs ICE Brent 1st month" -> 1181, "Gas Oil 0.5 Singapore vs IPE Gas Oil 1st month (Settlement)" -> 147, "Urals CIF Rotterdam Crude Oil vs Med Dated Strip" -> 1503, "No.6 0.3% H/P NYH Cargoes (Platts) vs No.6 0.7% NYH Cargoes (Platts)" -> 1070, "NYMEX Heat 1st month" -> 29, "Prem Unl 10ppm FOB Med Cargoes (Platts) vs Prem Unl 10ppm FOB Rotterdam Barges (Argus)" -> 1184, "NYMEX Unleaded vs NYMEX Heat" -> 555, "Tapis (APPI) vs Dated Brent" -> 1242, "Maya European Crude" -> 756, "Urals Med vs Dated Brent" -> 102, "Prem Unl Euro-Bob Oxy NWE Barges (Argus)" -> 1312, "NYMEX RBOB vs NYMEX Heat" -> 936, "Naphtha CIF NWE Cargoes vs IPE Brent" -> 43, "No.2 USGC Waterborne (Platts) vs NYMEX Heat" -> 411, "Gas Oil ULSD USGC Pipeline (Platts) vs. Jet 54 USGC Pipeline (Platts)" -> 1050, "Jet 54 Colonial Pipeline (Argus) vs Nymex Heat" -> 1288, "Dated Brent vs IPE Brent afternoon 1 minute marker" -> 935, "IPE Gas Oil [Settlement] vs Gas Oil 0.2% FOB Med Cargoes (Platts)" -> 397, "HSFO 180 CST Singapore" -> 8, "Mogas 95 Unl 10ppm NWE Barges (Argus) vs Jet CIF NWE Cargoes" -> 89, "3.5% Fuel FOB Med Cargoes vs 3.5% Fuel FOB Rotterdam Barges" -> 191, "NW Shelf (APPI) vs Dated Brent" -> 1501, "Unl 93 9RVP USGC Waterbourne (Platts) vs NYMEX RBOB 2nd month" -> 1108, "Dated Brent vs IPE Brent (DFL)" -> 83, "Nymex WTI 1st month plus Vasconia Differential" -> 1200, "No.2 USGC Pipeline vs NYMEX WTI" -> 90, "No.6 1% NYH Cargoes vs NYMEX WTI" -> 60, "Jet CIF NWE Cargoes vs Jet FOB Rotterdam Barges" -> 47, "No.2 LS USGC Pipeline (Platts) vs NYMEX Heat 2nd month" -> 1101, "3.5% Fuel FOB Rotterdam Barges" -> 5, "Ardjuna Crude (ICP) (prior July 07)" -> 754, "1% Fuel FOB NWE Cargoes vs IPE Brent" -> 120, "IPE Gas Oil [Settlement] vs Jet FOB Med Cargoes (Platts)" -> 398, "Gas Oil ULSD USGC Pipeline (Platts) vs Nymex Heat 2nd month" -> 1120, "No.2 USGC Pipeline vs NYMEX Heat" -> 22, "No.2 USGC Pipeline (Platts) vs NYMEX Heat 2nd month" -> 1100, "Baltic Supramax T/C Avg" -> 1306, "Naphtha CIF NWE Cargoes" -> 37, "Naphtha CFR Japan vs Naphtha CIF NWE Cargoes (Platts)" -> 1308, "Prem Unl Euro-Bob Oxy NWE Barges (Argus) vs Naphtha CIF NWE Physical" -> 1319, "Argus Propane CIF ARA vs Naphtha CIF NWE Cargoes" -> 132, "LLS 1st month (Argus) vs NYMEX WTI 1st month" -> 1536, "Gas Oil 0.1% CIF Med Cargoes (Platts) vs ICE Gas Oil 1st month" -> 1156, "1% Fuel FOB NWE Cargoes" -> 3, "IPE Brent 1st month" -> 28, "Capesize T/C Average (Baltic)" -> 512, "NYMEX RBOB vs NYMEX WTI" -> 940, "No.2 2000ppm Colonial Pipline (Argus) vs NYMEX Heat" -> 1301, "Argus Propane Far East Index vs Propane Saudi CP (Platts)" -> 430, "Minas (Platts) vs Asian Brent" -> 877, "Gas Oil 0.5 Singapore vs IPE Gas Oil [Average] (Platts)" -> 427, "Gas Oil 0.2 FOB Med Cargoes vs IPE Gas Oil (Settlement)" -> 81, "Jet FOB Med Cargoes (Platts) vs IPE Gas Oil (Settlement)" -> 724, "Minas Crude 1st month (Platts) vs ICE Brent 1st month" -> 1495, "Prem Unl FOB Rotterdam Barges vs Dated Brent" -> 410, "No.2 CARB LA Pipeline (Platts) vs Jet LA Pipeline (OPIS)" -> 700, "Jet 54 USGC Waterborne vs NYMEX Heat" -> 80, "Dated Brent vs Platts Brent (August)" -> 745, "Jet CIF NWE Cargoes (Platts) vs IPE Gas Oil [Settlement]" -> 391, "Gas Oil ULSD 50ppm CIF Med Cargoes (Platts) vs IPE Gas Oil" -> 839, "Unl 87 0.3% Max MTBE NYH Barges Supplemental (Platts) vs NYMEX RBOB" -> 995, "NYMEX WTI vs No.6 1% NYH Cargoes (Platts)" -> 921, "1% Fuel CIF Med Cargoes (Platts) vs 3.5% Fuel FOB Rotterdam Barges (Platts)" -> 585, "HSFO 180 CST Singapore vs Platts Dubai 1st month" -> 20, "Gas Oil ULSD 10ppm FOB Rotterdam Barges (Platts)" -> 883, "Jet FOB Med Cargoes (Platts) vs Jet CIF NWE Cargoes (Platts)" -> 453, "Widuri ICP formula (prior Oct 06)" -> 864, "Unl 87 USGC Waterborne vs NYMEX RBOB 2nd month" -> 1077, "Qua Iboe Diff Plus Dated Brent" -> 764, "1% Fuel FOB Rotterdam Barges vs 1% Fuel FOB NWE Cargoes" -> 106, "Naphtha CIF NWE Cargoes (Platts) vs Platts Brent 1st month" -> 404, "Prem Unl FOB Rotterdam Barges vs Naphtha CIF NWE Cargoes" -> 26, "No.6 1% NYH Cargoes vs No.6 3% USGC Waterborne" -> 12, "Dated Brent vs Platts Brent (September)" -> 746, "Mogas 92 Unl Singapore vs IPE Brent 1st month" -> 1479, "Jet Kero Singapore vs Gas Oil 0.5 Singapore" -> 53, "Reg Unl CARBOB LA Pipeline (OPIS) vs NYMEX RBOB" -> 962, "Gas Oil 0.5 Singapore Cargoes vs IPE Gas Oil [Settlement]" -> 413, "IPE Gas Oil [Settlement] vs Jet CIF NWE Cargoes (Platts)" -> 421, "Jet FOB Rotterdam Barges vs IPE Gasoil" -> 1048, "Unl 87 USGC Pipeline (Platts) vs NYMEX RBOB" -> 939, "Dated Brent vs Platts Brent (March)" -> 740, "Natural Gasoline Non-Dynergy Pipeline (Platts) vs 88% NYMEX WTI 1st Month" -> 403, "Reg Unl USGC Waterborne (Platts) vs Naphtha USGC Waterborne (Platts)" -> 401, "Prem Unl 10ppm FOB Med Cargoes (Platts)" -> 1183, "Gas Oil 0.2% CIF NWE Cargoes (Platts) vs IPE Gas Oil [Average] (Platts)" -> 406, "No.6 0.3% H/P NYH Cargoes (Platts) vs NYMEX WTI" -> 834, "Seria OSP vs IPE Brent Singapore 1 Minute Marker" -> 1450, "Tapis (APPI) vs Dubai 1st Month (Platts)" -> 1432, "Gas Oil 0.1% FOB Rotterdam Barges (Platts)" -> 1011, "Minas ICP Formula (prior Oct 07)" -> 959, "Prem 0.15 FOB Med Cargoes (Platts) vs Unl 95 FOB NWE Cargoes (Platts)" -> 429, "Unl 87 Rfg A2 Colonial Pipeline vs NYMEX Unleaded" -> 75, "Dated Brent" -> 40, "Prem Unl FOB NWE Cargoes vs IPE Brent" -> 25, "Prem Unl 50ppm FOB Med Cargoes (Platts) vs Prem Unl 10ppm FOB NWE Barges (Argus)" -> 584, "Gasoil 0.1% CIF NWE Cargoes (Platts) vs IPE Gasoil [Settlement]" -> 1051, "Butane Non-TET [USD/MT] (OPIS)" -> 1162, "Unl 95 Singapore Cargoes (Platts) vs Platts Dubai 1st Month" -> 500, "Maya US Crude" -> 759, "Jet CIF NWE Cargoes vs IPE Brent" -> 19, "Gas Oil 0.5 Singapore" -> 52, "Gas Oil ULSD 10ppm CIF NWE Cargoes (Platts)" -> 598, "30% Dated Brent + 70% Naphtha Singapore" -> 1259, "IPE Brent vs IPE Bwave 1st month (Platts)" -> 440, "Unl 87 NYH Barges (Argus) vs NYMEX RBOB 1st month" -> 1489, "Jet CIF NWE Cargoes" -> 18, "Jet 54 USGC Pipeline (platts) vs NYMEX Heat 2nd month" -> 1109, "Prem Unl 50% FOB Med 50% FOB Singapore Cargoes (Platts)" -> 1057, "No.6 1% NYH Cargoes (Platts) vs 1% Fuel FOB NWE Cargoes (Platts)" -> 573, "Gas Oil 0.005% FOB Tokyo Barges (RIM) vs Gas Oil 0.5% Singapore (Platts)" -> 588, "ULSD 15ppm NYH Barges (Argus) vs NYMEX Heat 1st month" -> 1435, "Tapis (APPI) vs ICE Brent 1st month" -> 1141, "Prem Unl 10ppm FOB Med Cargoes (Platts) vs Eurobob FOB ARA Barges (Platts)" -> 1486, "1% Fuel FOB NWE Cargoes vs 3.5% Fuel FOB Rotterdam Barges" -> 4, "Mogas 95 Unl 10ppm NWE Barges (Argus) vs IPE Brent" -> 104, "Gas Oil 0.1% CIF NWE Cargoes (Platts)" -> 1049, "No. 6 3% USGC Waterborne (Platts) vs 3.5% Fuel FOB Rotterdam Barges (Platts)" -> 1025, "IPE Gas Oil [Average] (Platts) vs Gas Oil EN590 CIF Med Cargoes (Platts)" -> 393, "Reg Unl Supplemental USGC Pipeline (Platts) vs NYMEX RBOB" -> 1016, "Prem Unl Euro-Bob Oxy NWE Barges vs Naphtha CIF NWE Cargoes (Argus)" -> 1318, "NYMEX Unleaded vs Unl 95 10ppm NWE Barges (Argus)" -> 723, "Urals CIF Med RCMB (Platts) formula" -> 861, "Duri ICP Formula (prior Oct 07)" -> 991, "NYMEX RBOB vs NYMEX Unleaded" -> 932, "Unl RBOB NYH Barges (Platts) vs NYMEX RBOB" -> 1173, "Unl 87 0.3% Max MTBE NYH Cargoes vs NYMEX RBOB" -> 969, "HSFO 180 CST Singapore vs 3.5% Fuel FOB Rotterdam Barges" -> 9, "Gas Oil 0.2 CIF Med Cargoes vs IPE Gas Oil (Settlement)" -> 82, "Jet CIF NWE Cargoes vs IPE Gas Oil (Average)" -> 54, "Jet Kero Singapore vs Platts Dubai 1st month" -> 45, "Minas (APPI) v IPE Brent 1st month" -> 1243, "Unl 87 0.3% Max MTBE NYH Barges (Platts) vs NYMEX Unleaded" -> 846, "Reg Unl CARBOB LA Pipeline (Platts) vs NYMEX Unleaded" -> 428, "Cinta ICP Formula (prior Oct 07)" -> 992, "IPE Gas Oil [Average] (Platts) vs Jet CIF NWE Cargoes (Platts)" -> 392, "Prem Unl 10 ppm FOB Rotterdam barges (Platts) vs IPE Brent" -> 755, "NYMEX Heat vs ICE Gas Oil 1st month" -> 1219, "Gas Oil ULSD 50ppm FOB Rotterdam Barges (Platts) vs IPE Gas Oil Average (Platts)" -> 422, "Unl 87 0.3% Max MTBE NYH Barges Supplemental (Platts) vs NYMEX Unleaded" -> 909, "IPE Brent vs Naphtha CIF NWE Cargoes (Platts)" -> 922, "Biodiesel Rapeseed OME FOB Rotterdam Barges (Argus) vs FAME-0 FOB Rotterdam Barges (Argus)" -> 1304, "FAME-0 FOB Rotterdam Barges (Argus) vs ICE Gas Oil 1st month (Platts)" -> 1334, "Unl 87 9RVP USGC Pipeline (Platts) vs NYMEX RBOB 2nd month" -> 1323, "Biodiesel Rapeseed OME FOB Rotterdam Barges (Argus) vs ICE Gas Oil 1st month 16:30 marker (Platts)" -> 1324, "Prem Unl 10ppm FOB Rotterdam Barges (Argus) vs Naphtha CIF NWE 1st month" -> 1086, "ULSD 61 8ppm Pipeline (Argus) vs Nymex Heat" -> 1290, "NW Shelf (APPI) vs Dubai 1st month (Platts)" -> 1266, "Dated Brent vs Platts Brent (June)" -> 743, "Mogas 95 Unl 10ppm NWE Barges (Argus)" -> 88, "IPE Brent vs Platts Dubai 1st month" -> 87, "No.6 2.2% NYH Cargoes (Platts) vs No.6 3% USGC Waterborne (Platts)" -> 418, "Prem Unl FOB Rotterdam Barges (Platts) vs Unl 95 10ppm FOB NWE Barges (Argus)" -> 830, "IPE Gas Oil (Settlement) vs IPE Brent" -> 103, "Capesize C7 Bolivar to Rotterdam (Baltic)" -> 524)
    indexToID.flatMap{
      case (k, v) => try {
        Some((k.toLowerCase -> Index.indexFromEAIQuoteID(v)))
      }
      catch {
        case e: UnknownIndexException => None
        case e: InvalidFormulaIndexException => None
      }
    } ++ Map("gas oil crack" -> FuturesSpreadIndex.GAS_OIL_CRACK)
  }

  def indexOption(indexName: String) = indexAliases.get(indexName.toLowerCase)
}